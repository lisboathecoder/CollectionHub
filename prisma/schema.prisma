// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Set {
  code        String    @id
  nameEn      String
  releaseDate DateTime?
  count       Int?
  packs       Pack[]
  cards       Card[]
}

model Pack {
  id      Int    @id @default(autoincrement())
  name    String
  setCode String
  set     Set    @relation(fields: [setCode], references: [code], onDelete: Cascade)
  cards   Card[]

  @@unique([setCode, name]) // cada pack é único dentro do set
}

model Rarity {
  code  String @id // ex.: C, U, R, RR, ...
  name  String // ex.: Common, Uncommon, ...
  cards Card[]
}

model Card {
  id      Int    @id @default(autoincrement())
  setCode String
  number  Int
  set     Set    @relation(fields: [setCode], references: [code], onDelete: Cascade)

  nameEn    String?
  slug      String?
  imageName String?

  rarityCode String?
  rarity     Rarity? @relation(fields: [rarityCode], references: [code])

  packs Pack[]

  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  Collection Collection[]

  @@unique([setCode, number])
}

model User {
  id         Int          @id @default(autoincrement())
  username   String       @unique
  email      String       @unique
  password   String
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  Collection Collection[]
}

model Collection {
  id        Int      @id @default(autoincrement())
  userId    Int
  cardId    Int
  moedaId   Int
  quantity  Int      @default(1)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  card      Card     @relation(fields: [cardId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, cardId])
}

