generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Set {
  code        String    @id
  nameEn      String
  releaseDate DateTime?
  count       Int?
  packs       Pack[]
  cards       Card[]
}

model Pack {
  id      Int    @id @default(autoincrement())
  name    String
  setCode String
  set     Set    @relation(fields: [setCode], references: [code], onDelete: Cascade)
  cards   Card[]

  @@unique([setCode, name])
}

model Rarity {
  code  String @id
  name  String
  cards Card[]
}

model Card {
  id      Int    @id @default(autoincrement())
  setCode String
  number  Int
  set     Set    @relation(fields: [setCode], references: [code], onDelete: Cascade)

  nameEn    String?
  slug      String?
  imageName String?
  imageUrl  String?

  rarityCode String?
  rarity     Rarity? @relation(fields: [rarityCode], references: [code])

  packs      Pack[]
  albumItems AlbumItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([setCode, number])
}

model User {
  id               Int        @id @default(autoincrement())
  username         String     @unique
  email            String     @unique
  password         String
  nickname         String?
  bio              String?
  avatarUrl        String?
  coverUrl         String?
  location         String?
  twoFactorCode    String?
  twoFactorExpires DateTime?
  resetCode        String?
  resetCodeExpires DateTime?
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
  albums           Album[]
  activities       Activity[]
}

model Album {
  id          Int         @id @default(autoincrement())
  userId      Int
  name        String
  description String?
  gameType    String      @default("pokemon")
  isPublic    Boolean     @default(false)
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  items       AlbumItem[]
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

model AlbumItem {
  id          Int      @id @default(autoincrement())
  albumId     Int
  album       Album    @relation(fields: [albumId], references: [id], onDelete: Cascade)
  cardId      Int?
  card        Card?    @relation(fields: [cardId], references: [id], onDelete: SetNull)
  customName  String?
  customImage String?
  quantity    Int      @default(1)
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Activity {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  type      String // ALBUM_CREATED, ALBUM_UPDATED, CARD_ADDED, CARD_REMOVED
  albumId   Int?
  albumName String?
  cardName  String?
  cardImage String?
  metadata  String? // JSON string com dados extras
  createdAt DateTime @default(now())

  @@index([userId, createdAt])
}
